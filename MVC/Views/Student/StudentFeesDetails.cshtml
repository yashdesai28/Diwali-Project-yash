<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <!-- Include jQuery, Kendo UI, and jsPDF libraries -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://kendo.cdn.telerik.com/2024.3.917/js/kendo.all.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="https://kendo.cdn.telerik.com/2024.3.917/styles/kendo.default-v2.min.css" />

    <style>
        /* Ensure the body and main container have proper dimensions */
        body,
        html {
            height: 100%;
            margin: 0;
            font-family: Arial, sans-serif;
        }

        #feesGrid {
            width: 100%;
            height: 80vh;
            /* Set height to allow grid to be visible */
            margin: 10px 0;
        }

        .k-actionsheet-container {
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        .k-actionsheet-container>.k-overlay {
            border-bottom-left-radius: 30px;
            border-bottom-right-radius: 30px;
        }

        #openActionSheetBttn {
            margin: 0 auto;
            display: block;
        }
    </style>
</head>

<body>
    <div id="feesGrid"></div>

    <!-- ActionSheet for payment action (hidden by default) -->
    <div id="payActionSheet"></div>

    <script>
        const userId = 10;

        $(document).ready(function () {
            // Initialize Kendo ActionSheet for payment options
            var actionsheet = $('#payActionSheet').kendoActionSheet({
                title: 'Select Payment Option',
                items: [
                    {
                        text: 'Pay by Card',
                        iconClass: 'k-i-pencil',
                        click: function (e) {
                            const dataItem = this.dataItem;
                            alert("Processing payment by Card for Payment ID: " + dataItem.c_paymentid);
                            actionsheet.close();
                        }
                    },
                    {
                        text: 'Pay by UPI',
                        iconClass: 'k-i-heart',
                        click: function (e) {
                            const dataItem = this.dataItem;
                            alert("Processing payment by UPI for Payment ID: " + dataItem.c_paymentid);
                            actionsheet.close();
                        }
                    },
                    {
                        text: 'Pay by Netbanking',
                        iconClass: 'k-i-upload',
                        click: function (e) {
                            const dataItem = this.dataItem;
                            alert("Processing payment by Netbanking for Payment ID: " + dataItem.c_paymentid);
                            actionsheet.close();
                        }
                    },
                    {
                        text: 'Cancel',
                        iconClass: 'k-i-cancel',
                        group: 'bottom',
                        click: function (e) {
                            actionsheet.close();
                        }
                    }
                ]
            }).data("kendoActionSheet");

            // Initialize the Kendo Grid
            $("#feesGrid").kendoGrid({
                dataSource: {
                    type: "json",
                    transport: {
                        read: {
                            url: `http://localhost:5064/api/Student/GetFeesDetails/${userId}`,  // Replace with the actual endpoint URL
                            dataType: "json",
                            type: "GET",
                        }
                    },
                    schema: {
                        model: {
                            fields: {
                                c_paymentid: { type: "number" },
                                c_enrollment_number: { type: "number" },
                                c_currentstandard: { type: "string" },
                                c_amount: { type: "number" },
                                c_status: { type: "string" },
                                c_paymentdate: { type: "date" }
                            }
                        }
                    },
                    pageSize: 20
                },
                pageable: true,
                sortable: true,
                filterable: true,
                columns: [
                    { field: "c_paymentid", title: "Payment ID" },
                    { field: "c_enrollment_number", title: "Enrollment Number" },
                    { field: "c_currentstandard", title: "Current Standard" },
                    { field: "c_amount", title: "Amount", format: "{0:n}" },
                    { field: "c_status", title: "Status" },
                    { field: "c_paymentdate", title: "Payment Date", format: "{0:MM/dd/yyyy}" },
                    {
                        title: "Action",
                        command: [{
                            name: "pay",
                            text: "Pay Fee",
                            visible: function (e) {
                                // Show the "Pay Fee" button if status is "Pending"
                                return e.c_status === "Pending";
                            },
                            click: function (e) {
                                const dataItem = this.dataItem($(e.currentTarget).closest("tr"));

                                // Open the ActionSheet and pass the dataItem
                                actionsheet.dataItem = dataItem;  // Save dataItem to the ActionSheet instance
                                actionsheet.open();
                            }
                        },
                        {
                            name: "download",
                            text: "Download Receipt",
                            visible: function (e) {
                                // Show the "Download Receipt" button if status is "Completed"
                                return e.c_status === "Completed";
                            },
                            click: function (e) {
                                const dataItem = this.dataItem($(e.currentTarget).closest("tr"));
                                const { jsPDF } = window.jspdf;
                                const doc = new jsPDF();

                                // Add content to the PDF
                                doc.setFontSize(16);
                                doc.text("Payment Receipt", 20, 20);

                                doc.setFontSize(12);
                                doc.text(`Payment ID: ${dataItem.c_paymentid}`, 20, 40);
                                doc.text(`Enrollment Number: ${dataItem.c_enrollment_number}`, 20, 50);
                                doc.text(`Standard: ${dataItem.c_currentstandard}`, 20, 60);
                                doc.text(`Amount: â‚¹${dataItem.c_amount.toFixed(2)}`, 20, 70);
                                doc.text(`Payment Status: ${dataItem.c_status}`, 20, 80);
                                doc.text(`Payment Date: ${new Date(dataItem.c_paymentdate).toLocaleDateString()}`, 20, 90);

                                // Save the PDF file
                                doc.save(`Payment_Receipt_${dataItem.c_paymentid}.pdf`);
                            }
                        }]
                    }
                ]
            });
        });
    </script>
</body>

</html>
